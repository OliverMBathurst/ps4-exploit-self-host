var ranPoc = false

window.loadPoc = function () {
	if (!ranPoc) {
		alert("running poc");
		poc()
		ranPoc = true
	}
}

window.goldset = function() {
    alert("GoldHEN loaded");
}

window.loadPayload = function (payload) {
    var payload_buffer = chain.syscall(477, new int64(0x26200000, 0x9), 0x300000, 7, 0x41000, -1, 0);
    var bufLen = payload.length;
    var payload_loader = p.malloc32(bufLen);
    var loader_writer = payload_loader.backing;
    for (var i = 0; i < bufLen / 4; i++) {
        var hxVal = payload.slice(i * 4, 4 + (i * 4)).split("").reverse().join("").split("").map(function (s) { return ("0000" + s.charCodeAt(0).toString(16)).slice(-2); }).join("");
        loader_writer[i] = parseInt(hxVal, 16);
    }
    chain.syscall(74, payload_loader, bufLen, (0x1 | 0x2 | 0x4));
    var pthread = p.malloc(0x10);
    chain.call(libKernelBase.add32(OFFSET_lk_pthread_create), pthread, 0x0, payload_loader, payload_buffer);
}