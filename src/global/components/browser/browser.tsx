import React, { memo, useContext } from 'react'
import { Item } from '..'
import { DirectoryContext } from '../../context/'
import { ItemType } from '../../enums'
import './styles.scss'

const Browser = () => {
    const {
        directoryMap,
        currentDirectory,
        hasAboveLevel,
        onPayloadSelected,
        onDirectorySwitch,
        onUpOneLevel
    } = useContext(DirectoryContext)

    if (!currentDirectory) {
        return null
    }

    return (
        <div className="browser">
            {hasAboveLevel &&
                <Item
                    key={`up-one-level-${currentDirectory.parent}`}
                    text="..."
                    title="Visit parent directory"
                    itemType={ItemType.Directory}
                    onClick={onUpOneLevel}
                />
            }
            {directoryMap
                && currentDirectory.directoryIds
                && currentDirectory.directoryIds.map(directoryId => {
                    const directory = directoryMap.get(directoryId)

                    if (!directory) {
                        return null
                    }

                    return (
                        <Item
                            key={`directory-${directory.name}`}
                            text={directory.name}
                            title={`Enters the directory "${directory.name}"`}
                            itemType={ItemType.Directory}
                            onClick={() => onDirectorySwitch(directory.id)}
                        />)
                })}
            {currentDirectory.payloads.map(payload => {
                return (
                    <Item
                        key={payload.fullName}
                        text={payload.name}
                        title={`Sends the ${payload.fullName} payload`}
                        itemType={ItemType.Payload}
                        color={payload.color}
                        onClick={() => onPayloadSelected(payload)}
                    />)
            })}
        </div>)
}

export default memo(Browser)