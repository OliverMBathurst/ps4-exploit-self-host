import React, { memo, useEffect, useState } from 'react'
import { Spinner } from '../../../assets/'
import { ICustomLoadEvent } from '../../interfaces'
import './styles.scss'

const Loader = () => {
    const [currentEventString, setCurrentEventString] = useState<string>('')

    useEffect(() => {
        let mounted = true

        const customLoadHandler = (event: CustomEvent<ICustomLoadEvent>) => {
            if (mounted) {
                setCurrentEventString(event.detail.data)
            }
        }

        window.addEventListener(
            window.CUSTOM_LOAD_EVENT,
            ((event: CustomEvent<ICustomLoadEvent>) => customLoadHandler(event)) as EventListener)

        return () => {
            mounted = false
            window.removeEventListener(
                window.CUSTOM_LOAD_EVENT,
                ((event: CustomEvent<ICustomLoadEvent>) => customLoadHandler(event)) as EventListener)
        }
    }, [])

    return (
        <div className="loader">
            <Spinner />
            <span className="loader__status-message medium-text noselect">
                {`${currentEventString || "Loading"}...`}
            </span>
        </div>)
}

export default memo(Loader)