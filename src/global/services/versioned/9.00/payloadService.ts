import { IModalInfo, IPayload, IPayloadService } from "../../../interfaces";
import { AbstractPayloadService } from "../../abstract";

class PayloadService extends AbstractPayloadService implements IPayloadService {
    portNumber: number = 9090

    handlePayload = (
        payload: IPayload,
        data: ArrayBuffer,
        binLoaderStatusEndpoint: string = `http://127.0.0.1:${this.portNumber}/status`,
        binLoaderEndpoint: string = `http://127.0.0.1:${this.portNumber}`,
        addModalCallback?: (modalInfo: IModalInfo) => void
    ): void => {
        try {
            if (payload.isHen) {
                window.HEN = data
                window.POC()
            } else {
                this.postBINLoaderPayload(
                    binLoaderStatusEndpoint,
                    binLoaderEndpoint,
                    data,
                    addModalCallback)
            }
        } catch (e) {
            console.error(e)

            if (addModalCallback) {
                addModalCallback({
                    title: "Unspecified Error",
                    message: e as string
                })
            }
        }
    }
}

export default PayloadService